#include <sbc.h>
#include <stdio.h>
#include <sbcmusic.h>
#include <bios.h>

/* instrument table */

char	  inst[128][16] =
	  {
	       /* instrument1 */
	       {   0x021,0x011,0x04C,0x000,0x0F1,0x0F2,0x063,0x072,
		   0x000,0x000,0x004,0x000,0x000,0x000,0x000,0x000 },

	       {   0x0A5,0x0B1,0x0D2,0x080,0x081,0x0F1,0x003,0x005,
		   0x000,0x000,0x002,0x000,0x000,0x000,0x000,0x000 },

	       {   0x072,0x062,0x01C,0x005,0x051,0x052,0x003,0x013,
		   0x000,0x000,0x00E,0x000,0x000,0x000,0x000,0x000 },

	       {   0x011,0x001,0x08A,0x040,0x0F1,0x0F1,0x011,0x0B3,
		   0x000,0x000,0x006,0x000,0x000,0x000,0x000,0x000 },

	       {   0x021,0x011,0x011,0x000,0x0A3,0x0C4,0x043,0x022,
		   0x002,0x000,0x00D,0x000,0x000,0x000,0x000,0x000 },

	       /* instrument6 */
	       {   0x031,0x0A1,0x01C,0x080,0x041,0x092,0x00B,0x03B,
		   0x000,0x000,0x00E,0x000,0x000,0x000,0x000,0x000 },

	       {   0x071,0x062,0x0C5,0x005,0x06E,0x08B,0x017,0x00E,
		   0x000,0x000,0x002,0x000,0x000,0x000,0x000,0x000 },

	       {   0x041,0x091,0x083,0x000,0x065,0x032,0x005,0x074,
		   0x000,0x000,0x00A,0x000,0x000,0x000,0x000,0x000 },

	       {   0x032,0x016,0x087,0x080,0x0A1,0x07D,0x010,0x033,
		   0x000,0x000,0x008,0x000,0x000,0x000,0x000,0x000 },

	       {   0x001,0x013,0x08D,0x000,0x051,0x052,0x053,0x07C,
		   0x001,0x000,0x00C,0x000,0x000,0x000,0x000,0x000 }
	  } ;

	  /* Only first 10 instruments are defined here */


main ()
{
     /* Set I/O address to 220H */

     ct_io_addx = 0x220 ;

     if ( sbc_check_card () & 2 )
     {
	  sbfd_init () ;

	  sbfd_instrument ( (char far *) inst ) ;

	  play_scale () ;

	  sbfd_reset () ;
     }
     else
	  printf("FM Music Card not available or wrong I/O address setting\n");
}


#pragma loop_opt(off)

/* ------------------------------------------------------------------
 *   Play a 'major scale' for each of the 10 instruments defined
 * ----------------------------------------------------------------*/
play_scale ()
{
     unsigned int   i, j ;
     int	    inst ;
     int	    note ;

     /* Look up table for midi value of a 'scale' starts from 'middle C' */

     static unsigned char   note_num[] = { 60, 62, 64, 65, 67, 69, 71, 72 } ;


     for ( inst= 0; inst < 10; inst++ )
     {
	  sbfd_program_change ( 0, inst ) ;

	  for ( note=0; note < 8; note++ )
	  {
	       sbfd_note_on ( 0, note_num[note], 0x40 ) ;

	       for (i=0; i<100; i++)
		    for (j=0; j < 1000; j++) ;

	       sbfd_note_off ( 0, note_num[note], 0x40 ) ;
	  }
     }
}

#pragma loop_opt(on)


